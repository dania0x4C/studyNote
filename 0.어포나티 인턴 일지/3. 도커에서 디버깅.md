# Docker ê¸°ë°˜ NestJS ë””ë²„ê¹… ê°€ì´ë“œ

## ê°œìš”

ì´ ë¬¸ì„œëŠ”  í”„ë¡œì íŠ¸ì—ì„œ Docker í™˜ê²½ ë‚´ NestJS ì• í”Œë¦¬ì¼€ì´ì…˜ì„ **VS Code ë””ë²„ê±°ë¥¼ í†µí•´ ë””ë²„ê¸°**í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

ê¸°ë³¸ NestJS ì„œë²„ë¶€í„°ë¶€í„°, `nestjs-command`ë¥¼ í†µí•œ **CLI ëª…ë ¹ì–´ ì‹¤í–‰ í™˜ê²½ì—ì„œë„ ë””ë²„ê¸°**ê°€ëŠ¥í•˜ë„ë¡ ë‘ ê°œì˜ í™˜ê²½ì„ ëª¨ë‘ ë‹¤ë£°ì…ë‹ˆë‹¤.

---

##  ë””ë²„ê¸° ëª©ì  ë° ì‹œë‚˜ë¦¬ì˜¤

- NestJS ì• í”Œë¦¬ì¼€ì´ì…˜ì„ Docker ì»¤í…Œì´ë„ˆì—ì„œ ì‹¤í–‰ ì¤‘, ë¸Œë ˆì´í¬í¬ì¸íŠ¸ë¥¼ ì„¤ì •í•˜ê³  ë””ë²„ê¸°
- NestJS CLI ëª…ë ¹ì–´(nest-commander ë“±)ë¥¼ ì‹¤í–‰í•  ë•Œë„ ë™ì¼í•˜ê²Œ ë””ë²„ê¸° ê°€ëŠ¥

---

##  VS Code ë””ë²„ê¸° ì„¤ì • (`.vscode/launch.json`)

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Docker: Attach to Node",
      "type": "node",
      "request": "attach",
      "restart": false,
      "port": 9230,
      "address": "localhost",
      "localRoot": "${workspaceFolder}",
      "remoteRoot": "/usr/src/app",
      "timeout": 10000,
      "skipFiles": ["<node_internals>/**", "${workspaceFolder}/node_modules/**"]
    },
    {
      "name": "Debug CLI Commands",
      "type": "node",
      "request": "attach",
      "port": 9231,
      "address": "localhost",
      "localRoot": "${workspaceFolder}",
      "remoteRoot": "/usr/src/app",
      "restart": false,
      "timeout": 10000,
      "skipFiles": ["<node_internals>/**", "${workspaceFolder}/node_modules/**"]
    }
  ]
}
```

### ì„¤ì • í•­ëª© ì„¤ëª…

| ì†Œì‘           | ì„¤ëª…                                        |
| ------------ | ----------------------------------------- |
| `name`       | ë””ë²„ê¸° êµ¬ì„± ì´ë¦„. ë””ë²„ê·¸ ì‹¤í–‰ ì‹œ ì„ íƒë¨                   |
| `type`       | Node.js ë””ë²„ê¸°ì„ ìœ„í•œ ì„¤ì • ("node")               |
| `request`    | "attach": ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ Node í”„ë¡œì„¸ìŠ¤ì— ë””ë²„ê±° ì—°ê²°      |
| `restart`    | ë””ë²„ê±° ì¢…ë£Œ í›„ ì¬ì‹œì‘ ì—¬ë¶€ (falseë¡œ ì„¤ì • ê·¸ë§Œì´ ë” ì•ˆì •ì )     |
| `port`       | ì»¤í…Œì´ë„ˆì—ì„œ ì—´ì–´ì¤€ ë””ë²„ê·¸ í¬íŠ¸ (Main: 9230, CLI: 9231) |
| `address`    | VS Codeê°€ ì ‘ê·¼í•  ì£¼ì†Œ (localhost)               |
| `localRoot`  | ë¡œì»¤ í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œ                             |
| `remoteRoot` | ì»¤í…Œì´ë„ˆ ë‚´ë¶€ NestJS ê²½ë¡œ (/usr/src/app)          |
| `timeout`    | ë””ë²„ê±° ì—°ê²° ëŒ€ê¸° ì‹œê°„ (ms)                         |
| `skipFiles`  | ë””ë²„ê¸° ì‹œ ë¬´ì‹œí•  íŒŒì¼ (Node ë‚´ë¶€ ëª¨ë“ˆ ë° node_modules)  |

---

##  Docker Compose ì„¤ì •

`docker-compose.yml` íŒŒì¼ì—ì„œ ë‹¤ìŒ í•­ëª©ì„ ì¶”ê°€í•˜ê³  í•„ìš”ì— ë”°ë¥¸ ë³€ê²½ ì§€ì •ì„ í•©ë‹ˆë‹¤:

```yaml
services:
  linkview-backend:
    build:
      context: ../
      dockerfile: ./docker-local/Dockerfile
    volumes:
      - ../:/usr/src/app
    container_name: linkview-backend
    env_file: ../.env
    command: yarn start:debug
    environment:
      - PORT=3133
      - NODE_INSPECT_RESUME_ON_START=1
    ports:
      - 3133:3133
      - 9230:9230  # Main ì„œë²„ ë””ë²„ê·¸ í¬íŠ¸
      - 9231:9231  # CLI ë””ë²„ê·¸ í¬íŠ¸
    depends_on:
      - postgres
    networks:
      - network
```

### ì„¤ì • ì„¤ëª…

| í•­ëª© | ì„¤ëª… |
|------|------|
| `command` | ë””ë²„ê±° ê°€ëŠ¥í•œ ìƒíƒœë¡œ ì„œë²„ ì‹¤í–‰ (`package.json`ì°¸ê³ ) |
| `ports` | ë””ë²„ê·¸ í¬íŠ¸ë¥¼ ì»¤í…Œì´ë„ˆ ì™¸ë¶€ë¡œ ë„ì–´ì£¼ê¸° |
| `NODE_INSPECT_RESUME_ON_START` | Node ë””ë²„ê·¸ ì„¸ì…˜ì„ ìë™ìœ¼ë¡œ ì¬ê³„ì‚¬ |
| `volumes` | ë¡œì»¤ ì½”ë“œ ë³€ê²½ì„ ì»¤í…Œì´ë„ˆì— ë‹¤ì‹œ ë³µì‚¬ (í•˜íŠ¸ ë¦¬ë¡¯ë“œ ë³µì‚¬ íš¨ê³¼) |

---

## ğŸ“¦ `package.json` ìŠ¤í¬ë¦½íŠ¸

```json
"scripts": {
  "start:debug": "nest start --debug=0.0.0.0:9230 --watch",
  "start:debug-cli": "node --inspect=0.0.0.0:9231 -r ts-node/register src/main.ts"
}
```

### ìŠ¤í¬ë¦½íŠ¸ ì„¤ëª…

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `start:debug` | NestJS ì„œë²„ë¥¼ ë””ë²„ê·¸ ëª¨ë“œë¡œ ì‹¤í–‰ (9230 í¬íŠ¸ì—ì„œ ëŒ€ê¸°) |
| `start:debug-cli` | CLI ëª…ë ¹ì–´ ì‹¤í–‰ì‹œ ë””ë²„ê·¸ í¬íŠ¸(9231)ë¥¼ í†µí•´ ì—°ê²° ê°€ëŠ¥ |

#### ê°’ ì„¤ëª…:
- `--debug=0.0.0.0:9230`: NestJS ë””ë²„ê±°ë¥¼ í•´ë‹¹ IPì™€ í¬íŠ¸ì—ì„œ ëŒ€ê¸°
- `--inspect=0.0.0.0:9231`: Node.js ë””ë²„ê±° ëŒ€ê¸° ëª©ì ì˜ CLIì— ì ìš©
- `--watch`: íŒŒì¼ ë³€ê²½ì‹œ í¬í…Œ ê°±ì‹  (hot-reload)
- `-r ts-node/register`: TypeScript íŒŒì¼ì„ ë³´ê±´í•˜ì—¬ ë³´ì»¬ ë³´ë“œì—ì„œ ì‹¤í–‰ ê°€ëŠ¥

---

## ğŸš€ ë””ë²„ê¸° ì‹œì‘ ìˆœì„œ

### 1. Main ì„œë²„ ë””ë²„ê¸°

```bash
docker-compose up linkview-backend
```

- VS Codeì—ì„œ ë””ë²„ê¸° íŒ¨ë„ ì—´ê¸°
- êµ¬ì„± ì¤‘ `"Docker: Attach to Node"` ì„ íƒ í›„ ì‹¤í–‰ (F5)
- ë¸Œë ˆì´í¬í¬ì¸íŠ¸ë¥¼ ì›í•˜ëŠ” ìœ„ì¹˜ì— ì„¤ì •

### 2. CLI ëª…ë ¹ì–´ ë””ë²„ê¸°

```bash
docker exec -it linkview-backend yarn start:debug-cli your:command
```

- VS Codeì—ì„œ `"Debug CLI Commands"` êµ¬ì„± ì„ íƒ í›„ ì‹¤í–‰ (F5)
- `your:command` ë‚´ë¦¼ì˜ ì½”ë“œì—ì„œ ë¸Œë ˆì´í¬í¬ì¸íŠ¸ê°€ ìë¦¬

---

## ğŸ” ì°¸ê³  ìë¦¬

- [VS Code ê³µì‹ Node.js ë””ë²„ê¸° ê°€ì´ë“œ](https://code.visualstudio.com/docs/containers/debug-node)
- [NestJS ë””ë²„ê¸° ê°€ì´ë“œ](https://docs.nestjs.com/recipes/debugging)

